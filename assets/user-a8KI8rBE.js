import{g as a,a as x,c as N,k as P,f as S,l as k,r as c,b as M,s as A,p as D}from"./firebace-Cb3kG9CG.js";import{c as I,g as H,a as $,f as O}from"./requests-CicnuAer.js";import{c as R}from"./render-prod-cards-BG07nqjv.js";const m=a(".avatar__img img"),_=a(".avatar__reit span"),g=a(".info__name"),h=a(".info__all span"),w=a(".info__success span"),v=a(".info__about");async function B(e,n){let t=0;e.score.forEach(r=>{t+=Number(r)});const o=t/e.score.length,s={id:e.id,img:e.img,name:e.name,surname:e.surname,allCollections:e.myProds.length,succsesfulCollections:0,dateOfRegister:e.dateOfRegister,score:Math.round(o),about:e.about};e.myProds.forEach(r=>{n.forEach(i=>{i.id===r&&i.status&&s.succsesfulCollections++})}),j(s)}function j(e){!m||!_||!g||!h||!w||!v||(m.src=e.img,_.innerText=e.score.toString(),g.innerText=e.name+" "+e.surname,h.innerText=e.allCollections.toString(),w.innerText=e.succsesfulCollections.toString(),v.innerText=e.about)}const T=a(".avatar__btn"),d=a(".popup"),b=a(".popup__title span"),F=a(".popup__close"),l=x(".popup__star"),K=a(".popup__btn"),q=N.get("UID"),L=a(".avatar__reit span");function z(e){if(q){T?.addEventListener("click",()=>{d?.classList.add("popup_active"),f(),b&&(b.innerText=e.name+" "+e.surname);for(let n=0;n<l.length;n++)l[n].innerHTML=`
          <svg>
              <use href="#star-black"></use>
          </svg>
        `}),G(),f(),J(e);return}T?.addEventListener("click",()=>{window.location.href="/Kindred/log-in.html"})}function G(){F?.addEventListener("click",()=>{d?.classList.contains("popup_active")&&d?.classList.remove("popup_active"),f()})}function f(){const e=a("body");if(e){if(d?.classList.contains("popup_active")){e.style.overflow="hidden";return}e.style.overflow="auto"}}function J(e){l&&l.forEach(n=>{n.addEventListener("click",async()=>{const t=Number(n.id);for(let s=0;s<l.length;s++)l[s].innerHTML=`
          <svg>
              <use href="${s<t?"#star":"#star-black"}"></use>
          </svg>
        `;const o=await I(e.id);o&&Q(t,o)})})}function Q(e,n){K?.addEventListener("click",async()=>{try{const t=P(S,"users",n.id),s=[...n.score||[],e];if(await k(t,{score:s}),d?.classList.remove("popup_active"),!L)return;let r=0;s.forEach(p=>{r+=Number(p)});const i=r/s.length;L.innerText=Math.round(i).toString()}catch(t){console.error(t)}})}const C=a(".user-prods__title span");async function V(e,n,t){if(!C)return;C.innerHTML=e.name+" "+e.surname;const o=n.filter(s=>s.userId===e.id);console.log(o),await R(".user-prods__prods",o,t)}async function W(e,n,t){const o=a(e),s=[];if(n.forEach(r=>{t.forEach(i=>{r.userId==i.id&&s.push({id:r.id,img:r.img,title:r.title,info:r.info,userInfo:{id:i.id,name:`${i.name||"-"}.`,surname:i.surname},date:r.date})})}),!!o){if(o.innerHTML="",s.length===0){o.innerHTML="Звітність відсутня";return}s.sort((r,i)=>E(i.date).getTime()-E(r.date).getTime()).forEach(r=>{Y(r,o)})}}function E(e){const[n,t,o]=e.split(".").map(Number);return new Date(o,t-1,n)}function X(e,n=3){const t=e.match(/[^.!?]+[.!?]+/g);if(!t)return e;const o=t.slice(0,n).join(" ").trim();return t.length>n?o+"...":o}function Y(e,n){const t=c("a",["new",`new_${e.id}`]),o=c("div","new__img");o.innerHTML=`
    <img src="${e.img}" alt="new"/>
  `;const s=c("div","new__info"),r=c("p","new__title");r.innerText=e.title;const i=c("p","new__text");i.innerText=X(e.info,4);const p=c("p","new__date");p.innerText=e.date;const u=c("a",["new__btn","btn","btn_orange"]);u.innerText="Переглянути",s.appendChild(r),s.appendChild(i),s.appendChild(p),s.appendChild(u),t.appendChild(o),t.appendChild(s),n.appendChild(t)}const y=a(".user-news__title span");async function Z(e,n,t){if(!y)return;y.innerHTML=e.name+" "+e.surname;const o=n.filter(s=>s.userId===e.id);await W(".user-news__news",o,t)}const ee=new URLSearchParams(window.location.search),U=ee.get("id")||void 0;document.addEventListener("DOMContentLoaded",async()=>{if(!U)return;const e=await H(),n=await I(U),t=await $(),o=await O();!e||!n||!t||!o||(await B(n,e),await V(n,e,t),await Z(n,o,t),M(),z(n),A())});document.addEventListener("loadingIsFinished",()=>{D()});
