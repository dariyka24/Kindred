import{g as o,a as y,c as S,k as P,f as k,l as N,b as M,s as C,p as I}from"./firebace-Cb3kG9CG.js";import{c as T,g as x,a as A,f as H}from"./requests-8AYIeyfP.js";import{c as O}from"./render-prod-cards-BG07nqjv.js";import{r as D}from"./render-news-BruYhvYD.js";const p=o(".avatar__img img"),u=o(".avatar__reit span"),f=o(".info__name"),m=o(".info__all span"),_=o(".info__success span"),g=o(".info__about");async function R(e,n){let s=0;e.score.forEach(a=>{s+=Number(a)});const r=s/e.score.length,t={id:e.id,img:e.img,name:e.name,surname:e.surname,allCollections:e.myProds.length,succsesfulCollections:0,dateOfRegister:e.dateOfRegister,score:Math.round(r),about:e.about};e.myProds.forEach(a=>{n.forEach(l=>{l.id===a&&l.status&&t.succsesfulCollections++})}),$(t)}function $(e){!p||!u||!f||!m||!_||!g||(p.src=e.img,u.innerText=e.score.toString(),f.innerText=e.name+" "+e.surname,m.innerText=e.allCollections.toString(),_.innerText=e.succsesfulCollections.toString(),g.innerText=e.about)}const w=o(".avatar__btn"),c=o(".popup"),v=o(".popup__title span"),B=o(".popup__close"),i=y(".popup__star"),F=o(".popup__btn"),K=S.get("UID"),h=o(".avatar__reit span");function j(e){if(K){w?.addEventListener("click",()=>{c?.classList.add("popup_active"),d(),v&&(v.innerText=e.name+" "+e.surname);for(let n=0;n<i.length;n++)i[n].innerHTML=`
          <svg>
              <use href="#star-black"></use>
          </svg>
        `}),q(),d(),z(e);return}w?.addEventListener("click",()=>{window.location.href="/Kindred/log-in.html"})}function q(){B?.addEventListener("click",()=>{c?.classList.contains("popup_active")&&c?.classList.remove("popup_active"),d()})}function d(){const e=o("body");if(e){if(c?.classList.contains("popup_active")){e.style.overflow="hidden";return}e.style.overflow="auto"}}function z(e){i&&i.forEach(n=>{n.addEventListener("click",async()=>{const s=Number(n.id);for(let t=0;t<i.length;t++)i[t].innerHTML=`
          <svg>
              <use href="${t<s?"#star":"#star-black"}"></use>
          </svg>
        `;const r=await T(e.id);r&&G(s,r)})})}function G(e,n){F?.addEventListener("click",async()=>{try{const s=P(k,"users",n.id),t=[...n.score||[],e];if(await N(s,{score:t}),c?.classList.remove("popup_active"),d(),!h)return;let a=0;t.forEach(E=>{a+=Number(E)});const l=a/t.length;h.innerText=Math.round(l).toString()}catch(s){console.error(s)}})}const L=o(".user-prods__title span");async function J(e,n,s){if(!L)return;L.innerHTML=e.name+" "+e.surname;const r=n.filter(t=>t.userId===e.id);if(r.length===0){const t=o(".user-prods__prods");if(!t)return;t.innerHTML="",t.innerHTML="Користувач ще не створював збори";return}await O(".user-prods__prods",r,s)}const b=o(".user-news__title span");async function Q(e,n,s){if(!b)return;b.innerHTML=e.name+" "+e.surname;const r=n.filter(t=>t.userId===e.id);await D(".user-news__news",r,s)}const V=new URLSearchParams(window.location.search),U=V.get("id")||void 0;document.addEventListener("DOMContentLoaded",async()=>{if(!U)return;const e=await x(),n=await T(U),s=await A(),r=await H();!e||!n||!s||!r||(await R(n,e),await J(n,e,s),await Q(n,r,s),M(),j(n),C())});document.addEventListener("loadingIsFinished",()=>{I()});
