import{g as r,a as $,c as _,k as S,f as U,l as O,m as R,h as A,i as B,u as q,j as H,r as o,n as J,y as P}from"./firebace-Cb3kG9CG.js";import{I as N}from"./index-yFKSUj0c.js";import{J as z}from"./just-validate.es-C73wyOde.js";import{a as V}from"./add-reg-user-DRXa78pD.js";import{c as Z}from"./requests-8AYIeyfP.js";const m=r(".cabinet__tabs"),l=r(".drop-down__select");function mt(){window.innerWidth<768&&C(),window.addEventListener("resize",()=>{window.innerWidth<768?C():(l?.classList.remove("active"),m?.classList.remove("hidden"),m?.classList.remove("drop-down__menu"))})}function j(t){const e=t.textContent;e&&l&&(l.textContent=e,D())}function K(t){t.stopPropagation(),!(!l||!m)&&(l.classList.toggle("active"),m.classList.toggle("hidden"))}function C(){if(!m||!l)return;m.classList.add("drop-down__menu"),m.classList.add("hidden");const t=r(".tabs__nav-btn_active");t&&t.textContent&&(l.textContent=t.textContent.trim()),$(".tabs__nav-btn").forEach(a=>{a.addEventListener("click",()=>j(a))}),document.addEventListener("click",a=>G(a)),l.addEventListener("click",K)}function D(){l?.classList.remove("active"),m?.classList.add("hidden")}function G(t){!l?.contains(t.target)&&!m?.contains(t.target)&&D()}const b=$(".tabs__nav-btn"),k=$(".tabs__item"),w=new URLSearchParams(window.location.search);function pt(){X(),b.forEach(t=>{t.addEventListener("click",()=>Q(t))})}function Q(t){const e=t.getAttribute("data-tab"),a=r(e);e&&(t.classList.contains("active")||(b.forEach(s=>s.classList.remove("tabs__nav-btn_active")),k.forEach(s=>s.classList.remove("tabs__item_active")),t.classList.add("tabs__nav-btn_active"),a&&a.classList.add("tabs__item_active"),w.set("tab",e),window.history.replaceState({},"",`${window.location.pathname}?${w.toString()}`)))}function X(){const t=w.get("tab");if(!t){b[0].classList.add("tabs__nav-btn_active"),k[0]?.classList.add("tabs__item_active");return}const e=r(`.tabs__nav-btn[data-tab="${t}"]`),a=r(`.tabs__item${t}`);b.forEach(s=>s.classList.remove("tabs__nav-btn_active")),k.forEach(s=>s.classList.remove("tabs__item_active")),t&&(e?.classList.add("tabs__nav-btn_active"),a?.classList.add("tabs__item_active"))}const u=JSON.parse(localStorage.getItem("user")||"[]"),L=r("#name"),W=r("#surname"),M=r("#date"),I=r("#city"),x=r("#phone"),T=r("#email"),y=r("#about"),Y=r("#photo"),E=_.get("UID");function ht(){!L||!W||!M||!I||!x||!T||!y||(L.value=u.name,W.value=u.surname,M.value=u.dateOfBirth,I.value=u.city,x.value=u.phone,T.value=u.email,y.value=u.about)}async function tt(){try{const t=S(U,"users",u.id),e=Y?.files?.[0],a=await et(e);if(await O(t,{name:L?.value||"",surname:W?.value||"",dateOfBirth:M?.value||"",city:I?.value||"",phone:x?.value||"",email:T?.value||"",about:y?.value||"",img:a||""}),!E)return;await V(E)}catch(t){console.error(t)}}async function et(t=null){if(!t){const s=await R(S(U,"users",u.id));if(!s)throw new Error("Нет файла");return s.data()?.img?s.data()?.img:"https://firebasestorage.googleapis.com/v0/b/kindred-4b120.firebasestorage.app/o/users%2Funnamed.jpg?alt=media&token=3a5e0dbc-a6db-46dd-bced-cb0819533b37"}const e=A(B,`users/${t.name}`);return await q(e,t),await H(e)}function at(t){const e=o("div","done-pop-up");switch(t){case"збір":e.innerText="Збір успішно створено";break;case"новина":e.innerText="Новину успішно створено";break;case"закрито":e.innerText="Збір закрито";break;case"підтверджено":e.innerText="Платіж підтверджено";break;case"відхилено":e.innerText="Платіж відхилено";break;case"змінено":e.innerText="Роль змінено";break;default:e.innerText="Дані змінено"}r(".wrapper")?.appendChild(e),setTimeout(()=>{e.style.opacity="0"},5e3),setTimeout(()=>{r(".wrapper")?.removeChild(e)},6e3)}function gt(){const t=r("#acc-info");if(!t)return;st();const e=new z(t,{errorLabelStyle:{color:"#ff7d4e"},focusInvalidField:!0,lockForm:!1,validateBeforeSubmitting:!0});e.addField("#name",[{rule:"required",errorMessage:"Введіть ваше ім'я"},{rule:"minLength",value:2,errorMessage:"Довжина ім'я повинна бути більше 1 літери"},{rule:"maxLength",value:50,errorMessage:"Довжина ім'я повинна бути менше"},{rule:"customRegexp",value:/^[\p{L}’'\-]+$/u,errorMessage:"Допускаються тільки літери, апостроф та дефіс"}]).addField("#surname",[{rule:"required",errorMessage:"Введіть ваше прізвище"},{rule:"minLength",value:2,errorMessage:"Довжина прізвища повинна бути більше 1 літери"},{rule:"maxLength",value:50,errorMessage:"Довжина прізвища повинна бути менше"},{rule:"customRegexp",value:/^[\p{L}’'\-]+$/u,errorMessage:"Допускаються тільки літери, апостроф та дефіс"}]).addField("#date",[{rule:"required",errorMessage:"Це поле обовʼязкове"},{rule:"customRegexp",value:/^(0?[1-9]|[12][0-9]|3[01])[.\-\/](0?[1-9]|1[0-2])[.\-\/](19|20)\d{2}$/,errorMessage:"Введіть правильну дату у форматі дд.мм.рррр"}]).addField("#city",[{rule:"required",errorMessage:"Введіть маше місто проживання"},{rule:"minLength",value:2,errorMessage:"Довжина міста повинна бути більше 1 літери"},{rule:"maxLength",value:50,errorMessage:"Довжина міста повинна бути менше"},{rule:"customRegexp",value:/^[\p{L}]+$/u,errorMessage:"Допускаються тільки літери"}]).addField("#email",[{rule:"required",errorMessage:"Це обов'язкове поле"},{rule:"customRegexp",value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z]{2,})$/,errorMessage:"Перевірте правильність написання пошти"}]).addField("#phone",[{rule:"required",errorMessage:"Це обов'язкове поле"},{rule:"custom",validator:a=>{const s=[{mask:"+{1} (000) 000-0000",startsWith:"1"},{mask:"+{7} (000) 000-00-00",startsWith:"7"},{mask:"+{380} (00) 000-00-00",startsWith:"380"},{mask:"+{44} (0000) 000000",startsWith:"44"},{mask:"+{49} (000) 000-0000",startsWith:"49"},{mask:"+{86} (000) 0000-0000",startsWith:"86"},{mask:"+{33} (0) 0 00 00 00 00",startsWith:"33"},{mask:"+{39} 0 000 000 000",startsWith:"39"},{mask:"+{34} 000 000 000",startsWith:"34"},{mask:"+{61} (0) 0000 0000",startsWith:"61"},{mask:"+{81} (0) 0-0000-0000",startsWith:"81"},{mask:"+{91} 0000 000 000",startsWith:"91"},{mask:"+{52} (0) 000 0000 0000",startsWith:"52"},{mask:"+{55} (0) 00 0000-0000",startsWith:"55"},{mask:"+{82} (0) 0-0000-0000",startsWith:"82"},{mask:"+{90} 000 000 00 00",startsWith:"90"},{mask:"+{27} 000 000 000",startsWith:"27"},{mask:"+{64} 0 000 000 000",startsWith:"64"},{mask:"+{65} 0000 0000",startsWith:"65"},{mask:"+{48} 000 000 000",startsWith:"48"}],c=a.replace(/\D/g,"");return s.some(p=>c.startsWith(p.startsWith))},errorMessage:"Номер телефону має починатися з одного з дійсних кодів країни"}]).addField("#about",[{rule:"required",errorMessage:"Це обов'язкове поле для заповнення"},{rule:"minLength",value:20,errorMessage:"Напишіть трохи більше інформації"}]),e.onSuccess(async()=>{await tt(),at("")})}function st(){const t=r("#phone");t&&N(t,{mask:[{mask:"+{1} (000) 000-0000",startsWith:"1"},{mask:"+{7} (000) 000-00-00",startsWith:"7"},{mask:"+{380} (00) 000-00-00",startsWith:"380"},{mask:"+{44} (0000) 000000",startsWith:"44"},{mask:"+{49} (000) 000-0000",startsWith:"49"},{mask:"+{86} (000) 0000-0000",startsWith:"86"},{mask:"+{33} (0) 0 00 00 00 00",startsWith:"33"},{mask:"+{39} 0 000 000 000",startsWith:"39"},{mask:"+{34} 000 000 000",startsWith:"34"},{mask:"+{61} (0) 0000 0000",startsWith:"61"},{mask:"+{81} (0) 0-0000-0000",startsWith:"81"},{mask:"+{91} 0000 000 000",startsWith:"91"},{mask:"+{52} (0) 000 0000 0000",startsWith:"52"},{mask:"+{55} (0) 00 0000-0000",startsWith:"55"},{mask:"+{82} (0) 0-0000-0000",startsWith:"82"},{mask:"+{90} 000 000 00 00",startsWith:"90"},{mask:"+{27} 000 000 000",startsWith:"27"},{mask:"+{64} 0 000 000 000",startsWith:"64"},{mask:"+{65} 0000 0000",startsWith:"65"},{mask:"+{48} 000 000 000",startsWith:"48"},{mask:"+000 (00) 000-00-00",startsWith:""}],dispatch:(e,a)=>{let s=(a.value+e).replace(/\D/g,"");return a.compiledMasks.find(c=>c.startsWith&&s.startsWith(c.startsWith))||a.compiledMasks[a.compiledMasks.length-1]}})}const rt=r(".tabs__nav-btn_log-out");async function vt(){rt?.addEventListener("click",async()=>{try{const t=J();P(t).then(()=>{_.remove("UID",{path:"/"}),_.remove("Role",{path:"/"}),localStorage.removeItem("user"),window.location.href="/Kindred/index.html"})}catch(t){console.error(t)}})}const nt=JSON.parse(localStorage.getItem("user")||"[]");async function ft(t,e){const a=r(".my-orders__content"),s=[],c=await Z(nt.id),p=Array.isArray(c?.supportedProds)?c.supportedProds:[];if(!a)return;if(!p||p.length===0){a.innerHTML="Ви не брали участі у зборах.";return}const g=new Map(e.map(n=>[n.id,n])),v=new Map(t.map(n=>[n.id,n]));p.forEach(n=>{const i=v.get(n);if(!i)return;const d=g.get(i.userId);if(!d)return;let h=0;d.score.forEach(F=>{h+=Number(F)});const f=h/d.score.length;s.push({id:i.id,img:i.img,title:i.title,goal:i.goal,collected:i.collected,userInfo:{id:d.id,name:`${d.name?.[0]||"-"}.`,surname:d.surname,score:Math.round(f)},date:i.date})}),a.innerHTML="",s.forEach(n=>{ot(n,a)})}function ot(t,e){const a=o("div",["prod",`prod_${t.id}`]),s=o("a",["prod__card","card",`card_${t.id}`]);s.href=`prod.html?id=${t.id}`;const c=o("div","card__img");c.innerHTML=`
    <img src="${t.img}" alt="${t.title}"/>
  `;const p=o("div","card__title");p.innerText=t.title;const g=o("div","card__goal");g.innerHTML=`Мета: <span>${t.goal}</span> грн.`;const v=o("div","card__collected");v.innerHTML=`Зібрано: <span>${t.collected}</span> грн.`;const n=o("div",["card__progress-bar","progress-bar"]),i=o("div","progress-bar__progress");i.style.width=t.collected*100/t.goal+"%",n.appendChild(i);const d=o("div","card__user"),h=o("div","card__user-fio");h.innerHTML=`Волонтер: <span>${t.userInfo.surname} ${t.userInfo.name?t.userInfo.name.charAt(0).toUpperCase()+".":""}</span>`;const f=o("div","card__user-score");f.innerHTML=`
    ${t.userInfo.score} 
    <svg>
        <use href="#star"></use>
    </svg>`,d.appendChild(h),d.appendChild(f),s.append(c),s.append(p),s.append(g),s.append(v),s.append(n),s.append(d),a.appendChild(s),e.appendChild(a)}function _t(){const t=JSON.parse(JSON.stringify(localStorage.getItem("user")))||!1;(!_.get("UID")||!t)&&(window.location.href="/Kindred/index.html")}export{mt as a,ht as b,ft as c,at as d,pt as i,vt as l,_t as r,gt as v};
