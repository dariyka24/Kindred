import{n as m,g as n,o as g,e as f,f as p,q as h,b as w,s as v,p as y}from"./firebace-Cb3kG9CG.js";import{J as M}from"./just-validate.es-C73wyOde.js";import{a as b}from"./add-reg-user-DRXa78pD.js";const I=m(),e=n(".form__error");async function L(){const r=n("#email"),a=n("#password");if(!r||!a||!e)return;const l=r.value,u=a.value;try{const t=await g(f(p,"users")),d=[];t.forEach(o=>{d.push({id:o.id,uid:o.data().uid,role:o.data().role})});const i=await h(I,l,u),c=i.user.uid,s=d.find(o=>o.uid===c);if(!s)throw new Error("del");e.style.opacity="0",document.cookie=`UID = ${i.user.uid}; max-age=259200; path=/`,document.cookie=`Role = ${s?.role}; max-age=259200; path=/`,await b(i.user.uid),s?.role=="admin"?window.location.href="/Kindred/cabinet-admin.html":s?.role=="volunteer"?window.location.href="/Kindred/cabinet-volunteer.html":window.location.href="/Kindred/cabinet-user.html"}catch(t){if(t instanceof Error&&t.message.includes("del")){e.innerText="Ваш акаунт було видалено без можливості відновлення",e.style.opacity="1";return}e.innerText="Невірний логін або пароль",e.style.opacity="1"}}function x(){const r=n("#log-in");if(!r)return;const a=new M(r,{errorLabelStyle:{color:"#ff7d4e"},focusInvalidField:!0,lockForm:!1,validateBeforeSubmitting:!0});a.addField("#email",[{rule:"required",errorMessage:"Це обов'язкове поле"},{rule:"customRegexp",value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z]{2,})$/,errorMessage:"Перевірте правильність написання пошти"}]).addField("#password",[{rule:"required",errorMessage:"Це обов'язкове поле"},{rule:"minLength",value:8,errorMessage:"Пароль повинен містити більше 8 знаків"},{rule:"maxLength",value:50,errorMessage:"Пароль повинен бути менше 50 знаків"},{rule:"customRegexp",value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/,errorMessage:"Пароль повинен містити великі, маленькі літери та числа"}]),a.onSuccess(async()=>{await L()})}document.addEventListener("DOMContentLoaded",async()=>{w(),x(),v()});document.addEventListener("loadingIsFinished",()=>{y()});
